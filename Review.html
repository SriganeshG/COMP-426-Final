 <!DOCTYPE html>
<html lang= "en">
<head>
    <title>  Ticket Service </title>

    <link rel = "stylesheet" type= "text/css" href ="style_review.css">

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
   
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/heroic-features.css" rel="stylesheet">




</head>
<body>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

  <script>

      function fillBuildingTypes() {
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
      if(this.readyState == 4 && this.status ==200) {
      var jsonObj = $.parseJSON(this.responseText);
      var innerText = "<option value='0'>All</option>";
      jQuery.each(jsonObj, function(index, value) {
      innerText += "<option value='";
                                   innerText += index;
                                   innerText += "'>";
        innerText += value;
        innerText += "</option>";
      });
      document.getElementById("buildingType").innerHTML = innerText;
      fillBuildings();
		}
	};
	xhttp.open("GET", "getLocationType.php", true);
	xhttp.send();
      }

      $(document).ready(fillBuildingTypes());

      function fillBuildings(){
	document.getElementById("reportTable").innerHTML = "";
      var x = document.getElementById("buildingType").value;

      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
      if(this.readyState == 4 && this.status == 200) {
      var jsonObj = $.parseJSON(this.responseText);
      var innerText = "<option value='0'>Choose a Building...</option>";
      jQuery.each(jsonObj, function(index, value) {
      innerText += "<option value='";
                                    innerText += index;
                                    innerText += "'>";
        innerText += value;
        innerText += "</option>";
      });
      document.getElementById("buildingName").innerHTML = innerText;
      fillTable();
      }};
      xhttp.open("GET", "getLocationType.php/"+x, true);
      xhttp.send();
      }
      function fillTable(){
	document.getElementById("reportTable").innerHTML = "";
      var type = document.getElementById("buildingType").value;
      var name = document.getElementById("buildingName").value;
      var x = "reportHeaders.php/";
      if(name == 0){
      if(type != 0){
      x += type;
      x += "?type";
      }
      } else {
      x += name;
      }
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
      if(this.readyState == 4 && this.status == 200) {
      var jsonObj = $.parseJSON(this.responseText);
      var innerText = "<tr><th>id</th><th>Building</th><th>Room</th><th>Date</th></tr>";
      var innerObj;
      jQuery.each(jsonObj, function(index, value) {
      innerObj = $.parseJSON(value);
      innerText += "<tr class='issue' value='"+index+"'><td>"+innerObj.id+"</td><td>"+innerObj.building+"</td><td>"+innerObj.room+"</td><td>"+innerObj.date+"</td></tr>"
      });
      document.getElementById("issueTable").innerHTML = innerText;
      }
      }
      xhttp.open("GET", x, true);
      xhttp.send();
      }
      function updateReportTable(id, building, room, issue, pictures){
      var innerText = "<tr><td>"+id+"</td><td>"+building+"</td><td>"+room+"</td></tr><tr><td colspan=3>"+issue+"</td>";
      if(pictures.length!=0){
      innerText += "</tr><tr><td colspan=3><h4>Click below for pictures of this issue</h4></td>"
      }
    for(i=0; i<pictures.length; i++) {
        if(i%3==0){
            innerText += "</tr><tr>";
        }
        innerText += "<td class='pic' value='imgs/"+pictures[i]+"'><img style='max-width:100%; height:auto;' src='imgs/"+pictures[i]+"'></td>";
    }
    innerText += "</tr>";
    document.getElementById("reportTable").innerHTML = innerText;
                                }
                                function updateMap(lat, long, name){

                                }

    </script>

  <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
      <div class="container">
        <a class="navbar-brand" href="index.html">Ticket Submission Service</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item active">
              <a class="nav-link" href="index.html">Home
                <span class="sr-only">(current)</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="Report.html">Submit Tickets</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="Review.html">Review Tickets</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="Contact.html">Contact</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <div class="leftside">

        <div class="reportSelection">
            <h3>Sort through reports of different buildings</h3>
            <div class="menu">
                <ul class="menuList">
                    <li>
                        <select onchange="fillBuildings()" id="buildingType" name="buildingType" class="myButton">
                            <option value="Type">Problem Type</option>
                            <option value="Hardware">Hardware</option>
                            <option value="Software">Software</option>
                            <option value="Networking">Networking</option>
                           
                          
                        </select>
                    </li>
                    <br>
                    <li>
                        <select onchange="fillTable()" id="buildingName" name="buildingName" class="myButton">
                    <option value="Building">Building</option>
                    <option value="Building1">Building1</option>
                    <option value="Building2">Building2</option>
                    <option value="Building3"C>Building3</option>
                    <option value="Building4">Building4</option>
                </select>
                    </li>
                </ul>

            </div>
            <br>
            <table id="issueTable" class="chart">
            </table>

            <table id="reportTable" class="chart">
            </table>


        </div>




</body>
<script>
  $('#issueTable').on('click', '.issue', function(){
  document.getElementById("pics").innerHTML = "";
  var x = "reports.php/";
  x += $(this).attr('value');
  x += "?single";
      var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
  //document.getElementById("pics").innerHTML = this.responseText;
  if(this.readyState == 4 && this.status == 200) {
      var jsonObj = $.parseJSON(this.responseText);
      updateReportTable(jsonObj.id, jsonObj.building, jsonObj.room, jsonObj.issue, jsonObj.pictures);
  }};
  xhttp.open("GET", x, true);
  xhttp.send();});
  $('#reportTable').on('click', '.pic', function(){
  var x = $(this).attr('value');
  document.getElementById("pics").innerHTML = "<img style='max-width:80%; height:auto;' src="+x+">";});
</script>

</html>
